<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>d) The runFAC() command • redstart</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="d) The runFAC() command">
<meta property="og:description" content="redstart">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">redstart</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a-Bio_Intro-FAC_demography.html">a) Biology Introduction: Full Annual Cycle (FAC) Demography</a>
    </li>
    <li>
      <a href="../articles/b-model_intro-RM_FAC_model.html">b) Model Introduction: The Runge &amp; Marra (2005) Full Annual Cycle Model</a>
    </li>
    <li>
      <a href="../articles/c-software_intro_rmFAC.html">c) Software introduction: The redstart package</a>
    </li>
    <li>
      <a href="../articles/d-the_runFAC_command.html">d) The runFAC() command</a>
    </li>
    <li>
      <a href="../articles/e-the_runFAC_multi_command.html">e) The runFAC_multi() command: Running multiple FACs to explore the effects varying parameters</a>
    </li>
    <li>
      <a href="../articles/f-make_figure_28_3.html">e) Making Runge and Mara Figure 28.3</a>
    </li>
    <li>
      <a href="../articles/g-make_figure_28_4.html">f) Making Runge and Mara Figure 28.4: variation in male territoriality</a>
    </li>
    <li>
      <a href="../articles/h-make_figure_28_5.html">g) Making Runge and Mara Figure 28.5</a>
    </li>
    <li>
      <a href="../articles/i-make_figure_28_6.html">f) Making Runge and Mara Figure 28.6</a>
    </li>
    <li>
      <a href="../articles/p-software_checks.html">p) Software checks</a>
    </li>
    <li>
      <a href="../articles/v-Sherry_Holmes_notes.html">v) Sherry-Holmes Notes</a>
    </li>
    <li>
      <a href="../articles/w-annotated_bib.html">w) Annotated bibliography</a>
    </li>
    <li>
      <a href="../articles/x-creating_a_package.html">w) Creating this package</a>
    </li>
    <li>
      <a href="../articles/y-building_a_package.html">z) Building and rebuilding vignettes - orig</a>
    </li>
    <li>
      <a href="../articles/z-MANUSCRIPT.html">(RE) Modeling Seasonal Interactions in the Population Dynamics of Migratory Birds</a>
    </li>
    <li>
      <a href="../articles/z-TODO.html">TO DO</a>
    </li>
    <li>
      <a href="../articles/z-build_and_rebuild_package.html">z) Building and rebuilding vignettes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="d-the_runFAC_command_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>d) The runFAC() command</h1>
                        <h4 class="author">Nathan L. Brouwer</h4>
            
            <h4 class="date">2022-03-07</h4>
      
      
      <div class="hidden name"><code>d-the_runFAC_command.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In the redstart package, a single run of a the full-annual cycle (FAC) is done using the runFAC() function. runFAC() is the engine underlying the core of the entire redstart package. You’ll rarely have to actually use this function except for diagnostic purposes. However, its worthwhile to know what its doing to understand how higher-level output is being generated.</p>
<p>The user gives this function 3 bundles of information:</p>
<ol style="list-style-type: decimal">
<li>The demographic parameters for the model, including survival rates and fecundities</li>
<li>The habitat carrying capacities (breeding and winter)</li>
<li>The initial population state. Specifically the abundance and age structure of male and females on the wintering ground in “good” and “poor” habitat.</li>
</ol>
<p>runFAC() then builds all of the matrices that describe the FAC, plugs in the starting population state, and turns the crank on the model for either a given number of iterations (the default is 300) or, if specified, until a stability criteria is met.</p>
<p>runFAC() can be set to run and either keep track of everything that happens during the entire model run (save.ts = T, the default), or just the final time point which (save.ts = F); …</p>
<p>TODO: what is this fragment of a sentence for? if the model reach equilibrium, represents that stable population size, stage, and sex structure of the model during each time point.</p>
<p>Examining the entire time series (“ts”) of the model is mostly useful for understanding what the model does and for diagnostics purposes, e.g. to makes sure it is reaching equilibrium. For most subsequent analyses just the equilibrium state is needed; a typical analysis of a FAC model involves running the model many times while systematically varying one or two key parameters to understand how they impact the equilibrium population state.</p>
<p>In this vignette I’ll demonstrate what <strong>runFAC()</strong> does and what the output of a single run the FAC looks like. In subsequent vignettes we’ll using a wrapper function, <strong>runFAC_multi()</strong> to run the model repeatedly to equilibrium while varying parameters such as carrying capacity (K). When doing simple explorations of how the function works I’ll set return.output = F so that the full output dataframe isn’t printed out into the R terminal.</p>
</div>
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<div id="getting-the-redstart-package" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-the-redstart-package" class="anchor"></a>Getting the redstart package</h3>
<p>The most recent version of redstart is available from github and can be downloaded directly using the devtools package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load devtools</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>

<span class="co">#download redstart from github</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"brouwern/redstart"</span><span class="op">)</span></code></pre></div>
<p>Load redstart into your current R sessions</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">redstart</span><span class="op">)</span></code></pre></div>
</div>
<div id="getting-parameters-for-a-model-run" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-parameters-for-a-model-run" class="anchor"></a>Getting parameters for a model run</h3>
<p>Default values are set in all of redstart’s functions so you can easily explore them without worrying about setting the underlying demographic parameters. For a preliminary run parameters will be called automatically behind the scenes using a function called <strong>param_set()</strong>, which default to the primary parameters used in Runge and Marra (2005).</p>
<p>You can look at the default parameters by calling the <strong>param_set()</strong> function. Later we’ll use <strong>param_set()</strong> to tweak a few parameters.</p>
<p>To view the parameter, call param_set() with empty parentheses (Output not shown)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/param_set.html">param_set</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Counting the 3 carrying capacities (K.bc, K.bk, K.wg) there are 30 parameters in a single run of the Runge and Marra (2005) FAC. We can see this using the length command.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/param_set.html">param_set</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 30</span></code></pre></div>
<p>The first 10 parameters are:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/param_set.html">param_set</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="co">#&gt;   gamma co K.bc  K.bk K.wg S.w.mg S.w.mp S.w.fg S.w.fp S.m.mg</span>
<span class="co">#&gt; 1     5  1 1000 10000  900    0.8    0.8    0.8    0.8    0.9</span></code></pre></div>
<p>For information on each parameter call the helpfile like this</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">param_set</span></code></pre></div>
<p>Additionally, there are four intial population size values for males and females in the two types of winter habitats. Defaults are set for these using the agreement “Ninint = c(….) within the <strong>runFAC()</strong> command itself. Call the help file on runFAC for more information (?runFAC)</p>
</div>
</div>
<div id="lets-do-this-running-a-runage-and-marra-fac" class="section level2">
<h2 class="hasAnchor">
<a href="#lets-do-this-running-a-runage-and-marra-fac" class="anchor"></a>Let’s do this! Running a Runage and Marra FAC</h2>
<p>When you call the <strong>runFAC()</strong> function an R <strong>list</strong> object is created. This list contains everything you put into runFAC() (the intial parameters) AND everything the model produced.</p>
<p>We can run the model and save its output to an object (Note that since there are defaults set within runFAC() you don’t have to include anything in the parentheses).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model at equilibrium after 103 iterations</span></code></pre></div>
<p>This should only take a few seconds, and you should get a short message about how many iterations it took to reach equilibrium. (By default runFAC() monitors whether stable population sizes have been reached and ends the model shortly after that point).</p>
<p>The output of runFAC() is a <strong>list</strong>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">is</span><span class="op">(</span><span class="va">my.fac</span><span class="op">)</span>
<span class="co">#&gt; [1] "list"   "vector"</span></code></pre></div>
<p>Lists are common R <strong>data structures</strong> but can take some getting used to when your first encounter them. The list produced by runFAC() has 8 elements, as shown by the length() command.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">)</span>
<span class="co">#&gt; [1] 8</span></code></pre></div>
<p>We can see the names of the 8 elements like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">)</span>
<span class="co">#&gt; [1] "FAC.out.RM"         "FAC.out.IB"         "FAC.eq.state.RM"   </span>
<span class="co">#&gt; [4] "FAC.eq.state.IB"    "W.mg.diagnostic.df" "param.matrices"    </span>
<span class="co">#&gt; [7] "params.initial"     "use.IBM"</span></code></pre></div>
<p>Again, this is dense object - some of the elements in the list are list themselves! For example, the element “param.matrices” is a list which contains all of the parametrized transition matrices for the model. We can check what each element of the my.fac list by using dollar sign notation to select the name of the element. Here is the parameter matrix element.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">is</span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">param.matrices</span><span class="op">)</span>
<span class="co">#&gt; [1] "list"   "vector"</span></code></pre></div>
<p>We can check how many matrices there are by again using the length() function</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">param.matrices</span><span class="op">)</span>
<span class="co">#&gt; [1] 8</span></code></pre></div>
<p>To look at the names of all the elements of the list we can also use the str() command to look at the output. The “1” tells str() to just give us the names of the elements in the list. This provides some more output than using names():</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">my.fac</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 8</span>
<span class="co">#&gt;  $ FAC.out.RM        :'data.frame':  350 obs. of  48 variables:</span>
<span class="co">#&gt;  $ FAC.out.IB        :'data.frame':  350 obs. of  42 variables:</span>
<span class="co">#&gt;  $ FAC.eq.state.RM   :'data.frame':  1 obs. of  48 variables:</span>
<span class="co">#&gt;  $ FAC.eq.state.IB   : logi NA</span>
<span class="co">#&gt;  $ W.mg.diagnostic.df:'data.frame':  350 obs. of  5 variables:</span>
<span class="co">#&gt;  $ param.matrices    :List of 8</span>
<span class="co">#&gt;  $ params.initial    :'data.frame':  1 obs. of  30 variables:</span>
<span class="co">#&gt;  $ use.IBM           : logi FALSE</span></code></pre></div>
<p>The elements of the my.fac list product by runFAC() are:</p>
<ol style="list-style-type: decimal">
<li>
<strong>FAC.out.RM</strong>: a dataframe containing the outputs from the original Runge and Mara FAC model (rmFAC)</li>
<li>
<strong>FAC.out.IB</strong>: a daframe containing the output from a slightly modified version of the model which uses an individual-based modeling (IBM) submodel (ibFAC) for some calculations. By default the ibFAC is not run.</li>
<li>
<strong>FAC.eq.state.RM</strong>: a vector with the state of the original rmFAC when the model reaches equilibrium</li>
<li>
<strong>FAC.eq.state.IB</strong>: a vector with the state of the ibFAC when the model reaches equilibrium.</li>
<li>
<strong>W.mg.diagnostic.df</strong>: TODO()</li>
<li>
<strong>param.matrices</strong>: All of the parameterized transition matrices describing the model</li>
<li>
<strong>params.initial</strong>: initial parameters used to set up the transition matrices</li>
<li>
<strong>use.IBM</strong>: indicator (TRUE/FALSE) if the individual-based (IBM) sub-model was run.</li>
</ol>
<p>The main output of runFAC() is “FAC.out.RM” and “FAC.eq.state.RM.” When many runs of the model are required we can just save the equilibrium state to improve performance of the model.</p>
<div id="a-basic-run-of-the-fac" class="section level3">
<h3 class="hasAnchor">
<a href="#a-basic-run-of-the-fac" class="anchor"></a>A basic run of the FAC</h3>
<p>We’ll call runFAC() with the argument return.output set to FALSE to suppress the output of a full time series. We’ll also set diagnostic.plot = T to see plot of the time series.</p>
<p>To be clear about what the options do, if I ran just this</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>I’d run then model and then get a big list with all the data output to my R terminal if I call up the my.fac object..</p>
<p>In contrast, the code below will run the model to equilibrium but won’t output anything - the object my.fac will be empty (NULL).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span>return.output <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model at equilibrium after 103 iterations</span></code></pre></div>
<p>We can see how the model progresses to equilibrium by setting the agreement diagnostic.plot = T. The my.fac object will be empty, but a diagnostic plot will be produced.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span>return.output <span class="op">=</span> <span class="cn">F</span>, 
                 diagnostic.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model at equilibrium after 103 iterations</span>
<span class="co">#&gt; Diagnostic plot build using runFAC.i$FAC.out.RM</span></code></pre></div>
<p><img src="d-the_runFAC_command_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>The diagnostic plot has three panels. On the left hand side is a graph of total winter population size (tot.W; black) and total breeding population size (tot.B, red). Winter population size is larger because birds die over the course of the winter and during spring migration The middle panel of the graph shows the realized population growth rate, calculated simply as winter population size in year t+1 divided by winter population size in year t. When growth stabilizes at 1.0, the model is at equilibrium. This criteria is used to assess when to stop running the model and report results.</p>
<p>The third panel of the diagnostic plot shows the winter structure of the population based on sex and habitat,</p>
<p>TODO: the sex ratio for the default parameters is highly skewed. Is this how its supposed to be? I think the figure legend might be labeled wrong. Cross reference with the barplot produced below.</p>
<p>The default behavior of runFAC() is save time by monitoring a run of the model for equilibrium. If you want to make sure your model is at equilibrium you can turn off the equilibrium monitoring using the check.eq argument; the model will then run for a default of 350 iterations.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span>return.output <span class="op">=</span> <span class="cn">F</span>,
       check.eq <span class="op">=</span> <span class="cn">FALSE</span>,
       diagnostic.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; Diagnostic plot build using runFAC.i$FAC.out.RM</span></code></pre></div>
<p><img src="d-the_runFAC_command_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>You can also specify a specific number of iterations</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## TODO: total pop size plot returned here is off; doesn't include zero</span>
<span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span>return.output <span class="op">=</span> <span class="cn">F</span>,
       iterations <span class="op">=</span> <span class="fl">20</span>,
       diagnostic.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>We can also have it run longer by making the equilibrium checker – which checks the time series for an asymptote – stricter. This can be done by increasing the “equilibrium tolerance”, eq.tol. The model will still check if the time series has reached an asymptote (check.eq = TRUE) but will be stricter about judging equilibrium. The default value of eq.tol to 6.</p>
<p>TODO: how is this scaled?</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span>return.output <span class="op">=</span> <span class="cn">F</span>,
       eq.to <span class="op">=</span> <span class="fl">10</span>,
       diagnostic.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>After we run a model we can also create the plot after the fact if we want using the function plot_runFAC(). First, let me re-run the model and save the object</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFAC.html">runFAC</a></span><span class="op">(</span>iterations <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model at equilibrium after 103 iterations</span></code></pre></div>
<p>Now use plot_runFAC()</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_runFAC.html">plot_runFAC</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.out.RM</span><span class="op">)</span></code></pre></div>
</div>
<div id="time-series-dataframe" class="section level3">
<h3 class="hasAnchor">
<a href="#time-series-dataframe" class="anchor"></a>Time series dataframe</h3>
<p>The main output of runFAC() is a dataframe containing the status of the population at each timestep. This dataframe is continued in the FAC.out.RM component of the list output by runFAC()</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.out.RM</span><span class="op">)</span>
<span class="co">#&gt;       W.mg W.mp     W.fg W.fp     B.mc B.mk B.md     B.fc B.fk P.cgg P.cgp</span>
<span class="co">#&gt; 1 10.65600    0 10.65600    0 7.200000    0    0 7.200000    0     1     0</span>
<span class="co">#&gt; 2 11.35503    0 11.35503    0 7.672320    0    0 7.672320    0     1     0</span>
<span class="co">#&gt; 3 12.09992    0 12.09992    0 8.175624    0    0 8.175624    0     1     0</span>
<span class="co">#&gt; 4 12.89368    0 12.89368    0 8.711945    0    0 8.711945    0     1     0</span>
<span class="co">#&gt; 5 13.73950    0 13.73950    0 9.283449    0    0 9.283449    0     1     0</span>
<span class="co">#&gt; 6 14.64082    0 14.64082    0 9.892443    0    0 9.892443    0     1     0</span>
<span class="co">#&gt;   P.cpg P.cpp P.kgg P.kgp P.kpg P.kpp     y.mc y.mk     y.fc y.fk A.G.mc A.G.mk</span>
<span class="co">#&gt; 1     0     0     0     0     0     0 5.184000    0 5.184000    0     NA     NA</span>
<span class="co">#&gt; 2     0     0     0     0     0     0 5.524070    0 5.524070    0     NA     NA</span>
<span class="co">#&gt; 3     0     0     0     0     0     0 5.886449    0 5.886449    0     NA     NA</span>
<span class="co">#&gt; 4     0     0     0     0     0     0 6.272601    0 6.272601    0     NA     NA</span>
<span class="co">#&gt; 5     0     0     0     0     0     0 6.684083    0 6.684083    0     NA     NA</span>
<span class="co">#&gt; 6     0     0     0     0     0     0 7.122559    0 7.122559    0     NA     NA</span>
<span class="co">#&gt;   A.G.md A.G.y.mc A.G.y.mk A.G.fc A.G.fk A.G.y.fc A.G.y.fk A.P.mc A.P.mk A.P.md</span>
<span class="co">#&gt; 1     NA       NA       NA     NA     NA       NA       NA     NA     NA     NA</span>
<span class="co">#&gt; 2     NA       NA       NA     NA     NA       NA       NA     NA     NA     NA</span>
<span class="co">#&gt; 3     NA       NA       NA     NA     NA       NA       NA     NA     NA     NA</span>
<span class="co">#&gt; 4     NA       NA       NA     NA     NA       NA       NA     NA     NA     NA</span>
<span class="co">#&gt; 5     NA       NA       NA     NA     NA       NA       NA     NA     NA     NA</span>
<span class="co">#&gt; 6     NA       NA       NA     NA     NA       NA       NA     NA     NA     NA</span>
<span class="co">#&gt;   A.P.y.mc A.P.y.mk A.P.fc A.P.fk A.P.y.fc A.P.y.fk lambda.B.mc.i</span>
<span class="co">#&gt; 1       NA       NA     NA     NA       NA       NA            NA</span>
<span class="co">#&gt; 2       NA       NA     NA     NA       NA       NA            NA</span>
<span class="co">#&gt; 3       NA       NA     NA     NA       NA       NA            NA</span>
<span class="co">#&gt; 4       NA       NA     NA     NA       NA       NA            NA</span>
<span class="co">#&gt; 5       NA       NA     NA     NA       NA       NA            NA</span>
<span class="co">#&gt; 6       NA       NA     NA     NA       NA       NA            NA</span>
<span class="co">#&gt;   lamb.B.mc.mean lamb.B.mc.var t    tot.B    tot.W tot.P.c tot.P.k lambda</span>
<span class="co">#&gt; 1             NA            NA 1 14.40000 21.31200       1       0     NA</span>
<span class="co">#&gt; 2             NA            NA 2 15.34464 22.71007       1       0 1.0656</span>
<span class="co">#&gt; 3             NA            NA 3 16.35125 24.19985       1       0 1.0656</span>
<span class="co">#&gt; 4             NA            NA 4 17.42389 25.78736       1       0 1.0656</span>
<span class="co">#&gt; 5             NA            NA 5 18.56690 27.47901       1       0 1.0656</span>
<span class="co">#&gt; 6             NA            NA 6 19.78489 29.28163       1       0 1.0656</span></code></pre></div>
<p>This time series contains information about how <strong>everything</strong> in the model changes over time and is the basis for the diagnostic plot. As implied above, we can have access this dataframe by removing “return.output = F”. (The default of runFAC() is returnet.output = T, but we’ve set it to false sometimes above so we don’t have to see all the crazy output. )</p>
<p>The dataframe is 45 columns wide and has the state variables for each step in the model, such as population sizes in each habitat</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">j.abundance.columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"W.mg"</span>,<span class="st">"W.mp"</span>,<span class="st">"W.fg"</span>,<span class="st">"W.fp"</span>,<span class="st">"B.mc"</span>,<span class="st">"B.mk"</span>,<span class="st">"B.md"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.out.RM</span><span class="op">[</span>,<span class="va">j.abundance.columns</span> <span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;       W.mg W.mp     W.fg W.fp     B.mc B.mk B.md</span>
<span class="co">#&gt; 1 10.65600    0 10.65600    0 7.200000    0    0</span>
<span class="co">#&gt; 2 11.35503    0 11.35503    0 7.672320    0    0</span>
<span class="co">#&gt; 3 12.09992    0 12.09992    0 8.175624    0    0</span>
<span class="co">#&gt; 4 12.89368    0 12.89368    0 8.711945    0    0</span>
<span class="co">#&gt; 5 13.73950    0 13.73950    0 9.283449    0    0</span>
<span class="co">#&gt; 6 14.64082    0 14.64082    0 9.892443    0    0</span></code></pre></div>
<p>The dataframe also has summary stats (e.g. sums of several column) such as the total breeding (tot.B), winter (tot.W) populations, and realized lambda (“lambda”).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">j.summary.columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tot.B"</span>,<span class="st">"tot.W"</span>,<span class="st">"tot.P.c"</span>,<span class="st">"tot.P.k"</span>,<span class="st">"lambda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.out.RM</span><span class="op">[</span>,<span class="va">j.summary.columns</span> <span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;      tot.B    tot.W tot.P.c tot.P.k lambda</span>
<span class="co">#&gt; 1 14.40000 21.31200       1       0     NA</span>
<span class="co">#&gt; 2 15.34464 22.71007       1       0 1.0656</span>
<span class="co">#&gt; 3 16.35125 24.19985       1       0 1.0656</span>
<span class="co">#&gt; 4 17.42389 25.78736       1       0 1.0656</span>
<span class="co">#&gt; 5 18.56690 27.47901       1       0 1.0656</span>
<span class="co">#&gt; 6 19.78489 29.28163       1       0 1.0656</span></code></pre></div>
<p>Each row in this dataframe is from one iteration of the model. NAs are VERY common in this dataframe and don’t indicate a problem - they occur when the model didn’t run long enough to assign values to that iteration because equilibrium was met.</p>
<p>TODO: purge NAs from df to make it easiert fo read</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.out.RM</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tot.B"</span>,<span class="st">"tot.W"</span>,<span class="st">"lambda"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;     tot.B tot.W lambda</span>
<span class="co">#&gt; 145    NA    NA     NA</span>
<span class="co">#&gt; 146    NA    NA     NA</span>
<span class="co">#&gt; 147    NA    NA     NA</span>
<span class="co">#&gt; 148    NA    NA     NA</span>
<span class="co">#&gt; 149    NA    NA     NA</span>
<span class="co">#&gt; 150    NA    NA     NA</span></code></pre></div>
</div>
<div id="returning-just-the-equilibrium-state" class="section level3">
<h3 class="hasAnchor">
<a href="#returning-just-the-equilibrium-state" class="anchor"></a>Returning just the equilibrium state</h3>
<p>Typically when doing an analysis of a FAC model we’ll just be interested in the final equilibrium state of the population. The information in the “FAC.out.RM” part of the output will be tossed and instead we’ll keep the information in “FAC.eq.state.RM”</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.eq.state.RM</span>
<span class="co">#&gt;        W.mg     W.mp    W.fg     W.fp B.mc     B.mk B.md B.fc     B.fk</span>
<span class="co">#&gt; 103 749.596 944.9938 150.404 1544.186 1000 220.0927    0 1000 220.0927</span>
<span class="co">#&gt;         P.cgg     P.cgp P.cpg   P.cpp P.kgg P.kgp P.kpg P.kpp     y.mc     y.mk</span>
<span class="co">#&gt; 103 0.1082909 0.4314182     0 0.46029     0     0     0     1 719.9994 74.28129</span>
<span class="co">#&gt;         y.fc     y.fk A.G.mc A.G.mk A.G.md A.G.y.mc A.G.y.mk A.G.fc A.G.fk</span>
<span class="co">#&gt; 103 719.9994 74.28129     NA     NA     NA       NA       NA     NA     NA</span>
<span class="co">#&gt;     A.G.y.fc A.G.y.fk A.P.mc A.P.mk A.P.md A.P.y.mc A.P.y.mk A.P.fc A.P.fk</span>
<span class="co">#&gt; 103       NA       NA     NA     NA     NA       NA       NA     NA     NA</span>
<span class="co">#&gt;     A.P.y.fc A.P.y.fk lambda.B.mc.i lamb.B.mc.mean lamb.B.mc.var   t    tot.B</span>
<span class="co">#&gt; 103       NA       NA            NA             NA            NA 103 2440.185</span>
<span class="co">#&gt;       tot.W   tot.P.c tot.P.k  lambda</span>
<span class="co">#&gt; 103 3389.18 0.9999991       1 1.00001</span></code></pre></div>
<p>This is just all the information the last (TODO - is this true) row from the main output dataframe (FAC.out.RM).</p>
<p>TODO(): simplify output of equilibrium output TODO: create summary function which makes a barplot of relevant information</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">my.fac</span><span class="op">$</span><span class="va">FAC.eq.state.RM</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">4.85</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="d-the_runFAC_command_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nathan Brouwer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
